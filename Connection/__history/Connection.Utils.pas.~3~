unit Connection.Utils;

interface

uses
  Data.SqlExpr, Common.Types;

type
  TDbParm = record
    AHost: string;
    APort: string;
    AFile: string;
    ARemoted: Boolean;
    procedure Clear;
  end;

  TZebedeeParm = record
    Active: Boolean;
    Host: string;
    Port: string;
    Path: string;
    procedure Clear;
  end;


function SetSQLConParm(const DbParm: TDbParm; const ZebedeeParm: TZebedeeParm; SQLCon: TSQLConnection): TFunctionResult;

implementation

function SetSQLConParm(const DbParm: TDbParm; const ZebedeeParm: TZebedeeParm; SQLCon: TSQLConnection): TFunctionResult;
var
  sDbConn: string;
begin
  Result := CloseSQLCon(SQLCon);
  if Result.Successful then
  try
    if DbParm.ARemoted and ZebedeeParm.Active then
    begin
      ZbdRun(DbParm, ZebedeeParm);
      sDbConn := Format('%s/%s:%s', [ZebedeeParm.Host, ZebedeeParm.Port, DbParm.AFile]);
    end
    else
    begin
      if ((DbParm.AHost = 'localhost') or (DbParm.AHost = '127.0.0.1')) and (DbParm.APort = '3050')
      then sDbConn := DbParm.AFile
      else sDbConn := Format('%s/%s:%s', [DbParm.AHost, DbParm.APort, DbParm.AFile]);
    end;

    SQLCon.DriverName     := 'Firebird';
    SQLCon.ConnectionName := 'FBSQLConnection';

    SQLCon.Params.Values['Database']       := sDbConn;
    SQLCon.Params.Values['User_name']      := s1;
    SQLCon.Params.Values['Password']       := s2;
    SQLCon.Params.Values['ServerCharSet']  := s3;
    SQLCon.Params.Values['SQLDialect']     := '3';

    SQLCon.LoginPrompt    := False;
  except
    on e: Exception do
    begin
      Result.Successful     := False;
      Result.MessageOnError := e.Message;
    end;
  end;
end;



end.
