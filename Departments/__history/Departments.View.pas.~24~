unit Departments.View;

interface

uses
  System.SysUtils, System.Types, System.UITypes, System.Classes, System.Variants,
  FMX.Types, FMX.Controls, FMX.Forms, FMX.Graphics, FMX.Dialogs,
  Departments.ViewModel, System.Rtti, FMX.Grid.Style, Fmx.Bind.Grid,
  System.Bindings.Outputs, Fmx.Bind.Editors, Data.Bind.EngExt,
  Fmx.Bind.DBEngExt, Data.Bind.Components, Data.Bind.Grid,
  FMX.Controls.Presentation, FMX.ScrollBox, FMX.Grid, Data.Bind.DBScope,
  Datasnap.Provider, Data.DB, Datasnap.DBClient, FMX.Header,
  Common.Form, FMX.StdCtrls, Departments.Classes, Data.Bind.ObjectScope,
  Departments.DataModule, DepartmentsReg.View, FMX.Edit;

type
  TDepartmentsForm = class(TCommonForm)
    Header1: THeader;
    GridBindSourceDB1: TGrid;
    btnNew: TButton;
    btnEdit: TButton;
    BindSourceDB1: TBindSourceDB;
    BindingsList1: TBindingsList;
    LinkGridToDataSourceBindSourceDB1: TLinkGridToDataSource;
    edtID: TEdit;
    edtTitle: TEdit;
    edtUpdtm: TEdit;
    chkIsActive: TCheckBox;
    PrototypeBindSource1: TPrototypeBindSource;
    lnkcntrltfld1: TLinkControlToField;
    lnkcntrltfld2: TLinkControlToField;
    lnkcntrltfld3: TLinkControlToField;
    lnkcntrltfld4: TLinkControlToField;
    procedure PrototypeBindSource1CreateAdapter(Sender: TObject;
      var ABindSourceAdapter: TBindSourceAdapter);
    procedure btnEditClick(Sender: TObject);
    procedure FormCreate(Sender: TObject);
  private
    FViewModel: TDepartmentsViewModel;
    { Private declarations }
  public
    procedure EditDepartment;
    { Public declarations }
  end;

var
  DepartmentsForm: TDepartmentsForm;

implementation

{$R *.fmx}

procedure TDepartmentsForm.btnEditClick(Sender: TObject);
begin
//  inherited;
  EditDepartment;
end;

procedure TDepartmentsForm.EditDepartment;
begin
  FViewModel.Model.AssignDepartmentValues;
  frmDepartmentsReg := TfrmDepartmentsReg.Create(Self, FViewModel);
  try
    frmDepartmentsReg.ShowModal;
  finally
    frmDepartmentsReg.Free;
  end;
end;

procedure TDepartmentsForm.FormCreate(Sender: TObject);
begin
  inherited;
  FViewModel := TDepartmentsViewModel.Create;

end;

procedure TDepartmentsForm.PrototypeBindSource1CreateAdapter(Sender: TObject;
  var ABindSourceAdapter: TBindSourceAdapter);
begin
//  inherited;
//  ABindSourceAdapter := TObjectBindSourceAdapter<TDepartment>.Create(PrototypeBindSource1,
//                                                               FViewModel.Department,
//                                                               False);
//  ABindSourceAdapter.AutoPost := True;

end;

initialization
  RegisterClass(TDepartmentsForm);

finalization
  UnRegisterClass(TDepartmentsForm);

end.
